require('dotenv').config();
const { GoogleGenerativeAI } = require("@google/generative-ai");

const apiKey = process.env.GEMINI_API_KEY;
if (!apiKey) {
  console.error("Error: GEMINI_API_KEY environment variable not found.");
  process.exit(1);
}

const genAI = new GoogleGenerativeAI(apiKey);

async function getGeminiResponse(prompt, context = "") {
  try {
    const model = genAI.getGenerativeModel({ 
      model: "gemini-pro",
      safetySettings: [
        {
          category: "HARM_CATEGORY_HARASSMENT",
          threshold: "BLOCK_NONE",
        },
        {
          category: "HARM_CATEGORY_HATE_SPEECH",
          threshold: "BLOCK_NONE",
        },
        {
          category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
          threshold: "BLOCK_NONE",
        },
        {
          category: "HARM_CATEGORY_DANGEROUS_CONTENT",
          threshold: "BLOCK_NONE",
        },
      ],
    });
    
    const fullPrompt = `${context}\n\n${prompt}\n\n–í—ñ–¥–ø–æ–≤—ñ–¥—å –º–∞—î –±—É—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é —Ç–∞ –º—ñ—Å—Ç–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –µ–º–æ–¥–∑—ñ –¥–ª—è –∫—Ä–∞—â–æ—ó –≤—ñ–∑—É–∞–ª—å–Ω–æ—ó –ø–æ–¥–∞—á—ñ.`;
    
    const result = await model.generateContent({
      contents: [{ role: "user", parts: [{ text: fullPrompt }] }],
      generationConfig: {
        temperature: 0.9,
        topK: 1,
        topP: 1,
        maxOutputTokens: 2048,
      },
    });
    
    const response = await result.response;
    const text = response.text();
    
    if (!text) {
      return '–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
    }
    
    return text;
  } catch (error) {
    console.error("Gemini API Error:", error.message);
    return '–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
  }
}

function getRandomEmoji() {
  const emojis = ['üéÆ', 'üé≤', 'üéØ', 'üé™', 'üé≠', 'üé®', 'üé™', 'üéØ', 'üé≤', 'üéÆ', 'üé™', 'üé≠', 'üé®', 'üéØ', 'üé≤', 'üéÆ'];
  return emojis[Math.floor(Math.random() * emojis.length)];
}

function getRandomAdjective() {
  const adjectives = ['–∑–∞—Ö–æ–ø–ª—é—é—á–∏–π', '–¥–∏–≤–æ–≤–∏–∂–Ω–∏–π', '–Ω–µ–π–º–æ–≤—ñ—Ä–Ω–∏–π', '—á—É–¥–æ–≤–∏–π', '—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω–∏–π', '–Ω–µ–∑–∞–±—É—Ç–Ω—ñ–π', '–º–∞–≥—ñ—á–Ω–∏–π', '—Ç–∞—î–º–Ω–∏—á–∏–π'];
  return adjectives[Math.floor(Math.random() * adjectives.length)];
}

function getRandomFlavor() {
  const flavors = [
    "–ó—Ä–æ–±–∏ —Ü–µ —É —Å—Ç–∏–ª—ñ —Ç–µ–ª–µ–≤–µ–¥—É—á–æ–≥–æ.",
    "–î–æ–¥–∞–π –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–π –∂–∞—Ä—Ç.",
    "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π —Å—Ç–∏–ª—å —Å—Ç–∞—Ä–æ–≥–æ –¥–µ—Ç–µ–∫—Ç–∏–≤–∞.",
    "–ó—Ä–æ–±–∏ —Ü–µ —É —Å—Ç–∏–ª—ñ —Ä–∞–¥—ñ–æ–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è.",
    "–î–æ–¥–∞–π –∑–∞–≥–∞–¥–∫—É —É –∫—ñ–Ω—Ü—ñ.",
    "–ó—Ä–æ–±–∏ —Ü–µ —É —Å—Ç–∏–ª—ñ –∫–æ–º—ñ–∫—Å—É.",
    "–î–æ–¥–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π —Å–ª–æ–≥–∞–Ω.",
    "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π —Å—Ç–∏–ª—å –∫–∞–∑–∫–∏.",
    "–î–æ–¥–∞–π –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏–π —Ñ–∞–∫—Ç –ø—Ä–æ –º–∞—Ñ—ñ—é.",
    "–ó—Ä–æ–±–∏ —Ü–µ —É —Å—Ç–∏–ª—ñ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–º–µ–Ω—Ç–∞—Ç–æ—Ä–∞."
  ];
  return flavors[Math.floor(Math.random() * flavors.length)];
}

async function getGameResponse(prompt, gameContext) {
  const context = "–¢–∏ - –ø–æ–º—ñ—á–Ω–∏–∫ —É –≥—Ä—ñ –ú–∞—Ñ—ñ—è. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –µ–º–æ–¥–∑—ñ —Ç–∞ –±—É–¥—å –¥—Ä—É–∂–Ω—ñ–º.";
  return getGeminiResponse(prompt, context);
}

async function generateBotMessage(messageType, data = {}) {
  const messagePrompts = {
    error: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –µ–º–æ–¥–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ"
    ],
    welcome: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –≥—Ä–∞–≤—Ü—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞ –≥—Ä–∏ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –≥—Ä–∞–≤—Ü—è –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ"
    ],
    gameStart: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ä—Ç –≥—Ä–∏ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ"
    ],
    gameEnd: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫—ñ–Ω–µ—Ü—å –≥—Ä–∏ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø—ñ–¥—Å—É–º–∫–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ"
    ],
    nightStart: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –Ω–æ—á—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–∞—Å—Ç–∞–Ω–Ω—è –Ω–æ—á—ñ –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æ–¥–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –Ω–æ—á—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    dayStart: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –¥–Ω—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    roleAssignment: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–æ–ª—ñ –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    voteStart: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ä—Ç –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    voteEnd: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫—ñ–Ω–µ—Ü—å –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    playerDeath: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å–º–µ—Ä—Ç—å –≥—Ä–∞–≤—Ü—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—Ç—Ä–∞—Ç—É –≥—Ä–∞–≤—Ü—è –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å–º–µ—Ä—Ç—å –≥—Ä–∞–≤—Ü—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    gameWin: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–º–æ–≥—É –∫–æ–º–∞–Ω–¥–∏ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–º–æ–≥—É –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–º–æ–≥—É –∫–æ–º–∞–Ω–¥–∏ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    roleAction: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ä–æ–ª—å –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    doctorHeal: [
      "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—Ä—è—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è –ª—ñ–∫–∞—Ä–µ–º –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—Ä—è—Ç—É–Ω–æ–∫ –≥—Ä–∞–≤—Ü—è –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—Ä—è—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ],
    commissionerCheck: [
      "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ä–æ–ª—ñ –≥—Ä–∞–≤—Ü—è –∫–æ–º—ñ—Å–∞—Ä–æ–º –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–ù–∞–ø–∏—à–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ –ú–∞—Ñ—ñ—ó —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ",
      "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ä–æ–ª—ñ –≤ –≥—Ä—ñ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"
    ]
  };

  let prompt;
  let context;

  switch (messageType) {
    case 'error':
      switch (data.type) {
        case 'registration_already_started':
          prompt = "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–∂–µ –ø–æ—á–∞–ª–∞—Å—å";
          break;
        case 'night_time':
          prompt = "–°—Ç–≤–æ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –∑–∞—Ä–∞–∑ –Ω—ñ—á —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—á–µ–∫–∞—Ç–∏ –¥–æ —Ä–∞–Ω–∫—É";
          break;
        case 'not_enough_players':
          prompt = "–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–∞–≤—Ü—ñ–≤ –¥–ª—è –ø–æ—á–∞—Ç–∫—É –≥—Ä–∏ (–º—ñ–Ω—ñ–º—É–º 4)";
          break;
        case 'not_mafia':
          prompt = "–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–µ —î –º–∞—Ñ—ñ—î—é";
          break;
        case 'not_doctor':
          prompt = "–°—Ç–≤–æ—Ä–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–µ —î –ª—ñ–∫–∞—Ä–µ–º";
          break;
        case 'not_commissioner':
          prompt = "–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–µ —î –∫–æ–º—ñ—Å–∞—Ä–æ–º";
          break;
        default:
          prompt = "–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É";
      }
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    case 'gameStart':
      if (data.timeout) {
        prompt = `–°—Ç–≤–æ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é –Ω–∞ –≥—Ä—É –≤ –ú–∞—Ñ—ñ—é. –î–æ –∫—ñ–Ω—Ü—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ${data.timeout} —Å–µ–∫—É–Ω–¥. ${getRandomFlavor()}`;
      } else if (data.playersCount) {
        prompt = `–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—ñ–≤: ${data.playersCount}, –ú–∞—Ñ—ñ—è: ${data.mafiaCount}, –ú–∏—Ä–Ω—ñ: ${data.peacefulCount}. ${getRandomFlavor()}`;
      } else {
        prompt = `–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –Ω–∞ –≥—Ä—É –≤ –ú–∞—Ñ—ñ—é. ${getRandomFlavor()}`;
      }
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ –≥—Ä–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    case 'roleAssignment':
      const roleContexts = {
        mafia: `–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –º–∞—Ñ—ñ—ó. –Ü–Ω—à—ñ –º–∞—Ñ—ñ–æ–∑–∏: ${data.otherMafia}. ${getRandomFlavor()}`,
        doctor: `–°—Ç–≤–æ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ª—ñ–∫–∞—Ä—è. ${getRandomFlavor()}`,
        commissioner: `–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ–º—ñ—Å–∞—Ä–∞. ${getRandomFlavor()}`,
        peaceful: `–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –º–∏—Ä–Ω–æ–≥–æ –∂–∏—Ç–µ–ª—è. ${getRandomFlavor()}`
      };
      prompt = roleContexts[data.role] || `–°—Ç–≤–æ—Ä–∏ –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ. ${getRandomFlavor()}`;
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    case 'roleAction':
      const roleActionContexts = {
        mafia: `–°—Ç–≤–æ—Ä–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –º–∞—Ñ—ñ—ó –ø—Ä–æ –≤–∏–±—ñ—Ä –∂–µ—Ä—Ç–≤–∏. ${getRandomFlavor()}`,
        doctor: `–°—Ç–≤–æ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ª—ñ–∫–∞—Ä—è –ø—Ä–æ –≤–∏–±—ñ—Ä –∫–æ–≥–æ –≤—Ä—è—Ç—É–≤–∞—Ç–∏. ${getRandomFlavor()}`,
        commissioner: `–°—Ç–≤–æ—Ä–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ–º—ñ—Å–∞—Ä–∞ –ø—Ä–æ –≤–∏–±—ñ—Ä –∫–æ–≥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏. ${getRandomFlavor()}`
      };
      prompt = roleActionContexts[data.role] || `–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ. ${getRandomFlavor()}`;
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    case 'doctorHeal':
      prompt = `–°—Ç–≤–æ—Ä–∏ –Ω–µ–∑–≤–∏—á–∞–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ –ª—ñ–∫–∞—Ä –≤—Ä—è—Ç—É–≤–∞–≤ –≥—Ä–∞–≤—Ü—è ${data.playerName}. ${getRandomFlavor()}`;
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—Ä—è—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    case 'commissionerCheck':
      prompt = `–°—Ç–≤–æ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –≥—Ä–∞–≤—Ü—è ${data.playerName}. –†–µ–∑—É–ª—å—Ç–∞—Ç: ${data.isMafia ? '–º–∞—Ñ—ñ—è' : '–º–∏—Ä–Ω–∏–π –∂–∏—Ç–µ–ª—å'}. ${getRandomFlavor()}`;
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
      break;

    default:
      const prompts = messagePrompts[messageType] || ["–°—Ç–≤–æ—Ä–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≥—Ä–∏ –ú–∞—Ñ—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ"];
      prompt = `${prompts[Math.floor(Math.random() * prompts.length)]} ${getRandomFlavor()}`;
      context = "–¢–∏ - –±–æ—Ç –¥–ª—è –≥—Ä–∏ –≤ –ú–∞—Ñ—ñ—é. –°—Ç–≤–æ—Ä—é–π –æ—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –∑ –µ–º–æd–∑—ñ.";
  }

  const randomEmoji = getRandomEmoji();
  const randomAdjective = getRandomAdjective();
  context += ` –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –µ–º–æ–¥–∑—ñ ${randomEmoji} —Ç–∞ –±—É–¥—å ${randomAdjective}.`;
  
  return getGeminiResponse(prompt, context);
}

module.exports = {
  getGeminiResponse,
  getGameResponse,
  generateBotMessage
}; 